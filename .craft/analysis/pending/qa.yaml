# QA Findings Queue
# Generated: 2026-02-08
# Scope: Whole application (code review)
# Total: 17 findings (2 critical, 6 high, 6 medium, 3 low)
updated: 2026-02-08
scope: whole-application

findings:
  - id: qa-001
    title: "FocusAreaProvider localStorage race condition with API fetch"
    priority: critical
    status: pending
    component: src/components/providers/FocusAreaProvider.tsx
    lines: "39-47"
    description: >
      selectedFocusAreaId loads from localStorage before focus areas are fetched
      from API. If stored ID no longer exists (deleted focus area), dropdown shows
      ID with no name.
    repro: "Select focus area > delete it in another tab > refresh > stale ID shown"

  - id: qa-002
    title: "Ensemble SSE stream not cleaned up on unmount"
    priority: critical
    status: pending
    component: src/hooks/useEnsemble.ts
    lines: "102-108"
    description: >
      ReadableStream reader continues processing after component unmounts.
      AbortController aborts fetch but reader.cancel() is never called.
      Memory leak + potential state updates on dead component.
    repro: "Type question > immediately clear search > check Network tab"

  - id: qa-003
    title: "Question detection triggers on single words"
    priority: high
    status: pending
    component: src/app/page.tsx
    lines: "20-53"
    description: >
      isQuestion() matches single words like 'how', 'what'. Word count >= 3
      check is separate, causing panel flicker while typing.
    repro: "Type 'how' in search bar > panel appears"

  - id: qa-004
    title: "Video detail date parsing can fail silently"
    priority: high
    status: pending
    component: src/app/videos/[id]/page.tsx
    lines: "52-56"
    description: >
      new Date() on malformed date strings creates Invalid Date objects,
      making video inaccessible. No validation or fallback.
    repro: "Rare — depends on API returning malformed dates"

  - id: qa-005
    title: "AddVideoPage debounce creates multiple timers"
    priority: high
    status: pending
    component: src/components/add-video/AddVideoPage.tsx
    lines: "52, 107"
    description: >
      useCallback with fetchTranscript dependency can recreate handleUrlChange,
      creating multiple concurrent debounce timers and API calls.
    repro: "Quickly paste multiple URLs > watch Network tab"

  - id: qa-006
    title: "Focus area deletion doesn't reset selection"
    priority: high
    status: pending
    component: src/components/layout/ManageFocusAreasModal.tsx
    lines: "61-77"
    description: >
      Deleting currently selected focus area leaves stale ID. Dropdown shows
      deleted area name, videos disappear with no explanation.
    repro: "Select area > Manage > delete selected area > dropdown shows deleted name"

  - id: qa-007
    title: "Search results don't update when focus area changes"
    priority: high
    status: pending
    component: src/hooks/useSearch.ts
    lines: "106"
    description: >
      focusAreaId is in effect deps but search doesn't re-run when query is
      unchanged. Results become stale after focus area switch.
    repro: "Search 'react' > change focus area > results unchanged"

  - id: qa-008
    title: "Transcript edit detection is backwards"
    priority: high
    status: pending
    component: src/components/add-video/AddVideoPage.tsx
    lines: "342-347"
    description: >
      value !== transcript comparison always true on first keystroke since
      value is the new value. Source tracking is cosmetic but incorrect.
    repro: "Auto-fetch transcript > edit one character > source changes"

  - id: qa-009
    title: "Empty state link points to non-existent /videos route"
    priority: medium
    status: pending
    component: src/components/search/SearchResults.tsx
    lines: "68-73"
    description: >
      'Go to videos to generate embeddings' link points to /videos (404).
      Should be / or /add.
    repro: "Search when no embeddings exist > click link > 404"

  - id: qa-010
    title: "VideoGrid shows search message when filtering by focus area"
    priority: medium
    status: pending
    component: src/components/videos/VideoGrid.tsx
    lines: "22-32"
    description: >
      Shows 'No results found — Try adjusting your search terms' when user
      is filtering by focus area, not searching. Misleading.
    repro: "Select focus area with 0 videos"

  - id: qa-011
    title: "Best Match badge hardcoded yellow may fail WCAG contrast"
    priority: medium
    status: pending
    component: src/components/personas/PersonaPanel.tsx
    lines: "52-56"
    description: >
      text-yellow-600/400 with secondary badge background may not meet
      WCAG AA contrast in all themes.
    repro: "Enable dark mode > ask question > check badge contrast"

  - id: qa-012
    title: "Discovery refresh may not propagate to ChannelSection"
    priority: medium
    status: pending
    component: src/app/discovery/page.tsx
    lines: "79-81, 150"
    description: >
      refreshTrigger prop passed to ChannelSection but need to verify it
      actually triggers re-fetch. May be a no-op.
    repro: "Follow channels > click Refresh > check if videos update"

  - id: qa-013
    title: "Ensemble API returns 404 instead of empty state"
    priority: medium
    status: pending
    component: src/app/api/personas/ensemble/route.ts
    lines: "69-74"
    description: >
      Returns 404 when no personas exist. Should return 200 with empty
      array so PersonaPanel shows helpful empty state.
    repro: "Fresh DB > ask question > error state instead of empty state"

  - id: qa-014
    title: "No error shown when transcript too short to submit"
    priority: medium
    status: pending
    component: src/components/add-video/AddVideoPage.tsx
    lines: "252, 371"
    description: >
      Submit button disabled when transcript < 50 chars but no error
      message explains why. User must guess.
    repro: "Add video > clear transcript > type < 50 chars > button disabled"

  - id: qa-015
    title: "Freshness badge uses hardcoded 7-day threshold"
    priority: low
    status: pending
    component: src/components/search/FreshnessBadge.tsx
    description: >
      Hardcoded 7-day threshold with no documentation or configuration.
      Should be a named constant.

  - id: qa-016
    title: "Similar creators scroll has no visual affordance"
    priority: low
    status: pending
    component: src/components/discovery/SimilarCreatorsSection.tsx
    lines: "125"
    description: >
      Horizontal scroll with no fade gradients or arrow buttons.
      Users may not realize they can scroll.

  - id: qa-017
    title: "Malformed SSE events silently ignored"
    priority: low
    status: pending
    component: src/hooks/useEnsemble.ts
    lines: "240-243"
    description: >
      JSON parse errors from SSE events caught with empty body.
      No console logging makes debugging difficult.
