---
timestamp: "2026-02-10 09:00:43"
story: "1-transcript-polish"
chunk: "unknown"
tool: "Bash"
error: |
  Exit code 1
src/app/api/personas/[id]/query/__tests__/route.test.ts(75,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(88,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(108,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(121,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(135,37): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(146,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(159,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(172,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(185,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
src/app/api/personas/[id]/query/__tests__/route.test.ts(198,54): error TS2353: Object literal may only specify known properties, and 'id' does not exist in type 'Promise<{ id: string; }>'.
---
timestamp: "2026-02-10 09:59:54"
story: "2-auto-embed"
chunk: "unknown"
tool: "Bash"
error: |
  Exit code 1

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 1 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/app/api/videos/__tests__/route.test.ts[2m > [22mPOST /api/videos[2m > [22mtriggers auto-embed when video is created with transcript
[31m[1mAssertionError[22m: expected "vi.fn()" to be called 1 times, but got 0 times[39m
[36m [2m‚ùØ[22m src/app/api/videos/__tests__/route.test.ts:[2m372:23[22m[39m
    [90m370| [39m
    [90m371| [39m    [90m// Verify after() was called with a function[39m
    [90m372| [39m    [34mexpect[39m(mockAfter)[33m.[39m[34mtoHaveBeenCalledTimes[39m([34m1[39m)
    [90m   | [39m                      [31m^[39m
    [90m373| [39m    [34mexpect[39m(mockAfter)[33m.[39m[34mtoHaveBeenCalledWith[39m(expect[33m.[39m[34many[39m([33mFunction[39m))
    [90m374| [39m  })

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/1]‚éØ[22m[39m



> gold-miner@0.1.0 test
> vitest run src/app/api/videos/__tests__/route.test.ts


[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/Users/darindrobinski/dev/repos/gold-miner[39m

 [31m‚ùØ[39m src/app/api/videos/__tests__/route.test.ts [2m([22m[2m21 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1369[2mms[22m[39m
     [32m‚úì[39m creates video with publishedAt field[32m 169[2mms[22m[39m
     [32m‚úì[39m creates video without publishedAt field (null)[32m 66[2mms[22m[39m
     [32m‚úì[39m returns publishedAt in video response when querying[32m 75[2mms[22m[39m
     [32m‚úì[39m handles invalid publishedAt format gracefully[32m 46[2mms[22m[39m
     [32m‚úì[39m creates video successfully without publishedAt for backward compatibility[32m 49[2mms[22m[39m
     [32m‚úì[39m creates transcript-type video without youtubeId[32m 51[2mms[22m[39m
     [32m‚úì[39m returns 400 when youtube-type video is missing youtubeId[32m 45[2mms[22m[39m
     [32m‚úì[39m returns 400 when transcript-type video is missing title[32m 44[2mms[22m[39m
     [32m‚úì[39m defaults to youtube sourceType when not provided[32m 49[2mms[22m[39m
     [32m‚úì[39m still checks for duplicate youtubeId on youtube-type videos[32m 55[2mms[22m[39m
     [32m‚úì[39m skips duplicate check for transcript-type videos[32m 60[2mms[22m[39m
     [32m‚úì[39m allows transcript-type video without channel (null)[32m 47[2mms[22m[39m
     [32m‚úì[39m returns 400 when youtube-type video is missing channel[32m 49[2mms[22m[39m
[31m     [31m√ó[31m triggers auto-embed when video is created with transcript[39m[32m 54[2mms[22m[39m
     [32m‚úì[39m does not trigger auto-embed when video has empty transcript[32m 46[2mms[22m[39m
     [32m‚úì[39m returns empty list when no videos exist[32m 76[2mms[22m[39m
     [32m‚úì[39m returns videos with all fields including publishedAt[32m 65[2mms[22m[39m
     [32m‚úì[39m filters videos by focusAreaId when provided[32m 87[2mms[22m[39m
     [32m‚úì[39m returns all videos when no focusAreaId provided[32m 96[2mms[22m[39m
     [32m‚úì[39m returns empty list when focus area has no videos[32m 81[2mms[22m[39m
     [32m‚úì[39m returns 400 for invalid focusAreaId[32m 55[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m20 passed[39m[22m[90m (21)[39m
[2m   Start at [22m 09:59:49
[2m   Duration [22m 5.09s[2m (transform 141ms, setup 284ms, import 1.01s, tests 1.37s, environment 1.86s)[22m
---
timestamp: "2026-02-10 10:02:29"
story: "2-auto-embed"
chunk: "unknown"
tool: "Bash"
error: |
  Exit code 1
npm error Missing script: "typecheck"
npm error
npm error To see a list of scripts, run:
npm error   npm run
npm error A complete log of this run can be found in: /Users/darindrobinski/.npm/_logs/2026-02-10T16_02_29_377Z-debug-0.log
---
timestamp: "2026-02-10 10:12:32"
story: "2-auto-embed"
chunk: "unknown"
tool: "Bash"
error: |
  Exit code 1
[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2minitial state[2m > [22m[2mstarts in idle state
[22m[39mFailed to check embedding status: TypeError: Cannot read properties of undefined (reading 'ok')
    at checkStatus [90m(/Users/darindrobinski/dev/repos/gold-miner/[39msrc/hooks/useEmbedding.ts:34:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2mcheckStatus[2m > [22m[2mhandles check status errors gracefully
[22m[39mFailed to check embedding status: Error: Network error
    at [90m/Users/darindrobinski/dev/repos/gold-miner/[39msrc/hooks/__tests__/useEmbedding.test.ts:62:39
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mtransitions through loading state
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mupdates state to success after successful embedding
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mhandles embedding errors
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behav

... [4420 characters truncated] ...

// Object.is equality

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div />[31m
  [36m</body>[31m
[36m</html>[31m[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m src/hooks/__tests__/useEmbedding.test.ts:[2m360:46[22m[39m
    [90m358| [39m
    [90m359| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m360| [39m        [34mexpect[39m(result[33m.[39mcurrent[33m.[39mhasEmbeddings)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m361| [39m      })[33m;[39m
    [90m362| [39m
[90m [2m‚ùØ[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2m‚ùØ[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/4]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/hooks/__tests__/useEmbedding.test.ts[2m > [22museEmbedding[2m > [22mreEmbed[2m > [22mhandles re-embed errors
[31m[1mAssertionError[22m: expected false to be true // Object.is equality

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div />[31m
  [36m</body>[31m
[36m</html>[31m[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m src/hooks/__tests__/useEmbedding.test.ts:[2m398:46[22m[39m
    [90m396| [39m
    [90m397| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m398| [39m        [34mexpect[39m(result[33m.[39mcurrent[33m.[39mhasEmbeddings)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m399| [39m      })[33m;[39m
    [90m400| [39m
[90m [2m‚ùØ[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2m‚ùØ[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/4]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/hooks/__tests__/useEmbedding.test.ts[2m > [22museEmbedding[2m > [22mreEmbed[2m > [22mdoes nothing if already loading
[31m[1mTypeError[22m: result.current.reEmbed is not a function[39m
[36m [2m‚ùØ[22m src/hooks/__tests__/useEmbedding.test.ts:[2m438:22[22m[39m
    [90m436| [39m      })[33m;[39m
    [90m437| [39m
    [90m438| [39m      result[33m.[39mcurrent[33m.[39m[34mreEmbed[39m()[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m439| [39m
    [90m440| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/4]‚éØ[22m[39m



> gold-miner@0.1.0 test
> vitest run src/hooks/__tests__/useEmbedding.test.ts


[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/Users/darindrobinski/dev/repos/gold-miner[39m

 [31m‚ùØ[39m src/hooks/__tests__/useEmbedding.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 2593[2mms[22m[39m
       [32m‚úì[39m starts in idle state[32m 21[2mms[22m[39m
       [32m‚úì[39m updates hasEmbeddings to true when embeddings exist[32m 55[2mms[22m[39m
       [32m‚úì[39m updates hasEmbeddings to false when no embeddings exist[32m 3[2mms[22m[39m
       [32m‚úì[39m handles check status errors gracefully[32m 5[2mms[22m[39m
       [32m‚úì[39m transitions through loading state[32m 108[2mms[22m[39m
       [32m‚úì[39m updates state to success after successful embedding[32m 55[2mms[22m[39m
       [32m‚úì[39m handles embedding errors[32m 55[2mms[22m[39m
       [32m‚úì[39m handles network errors[32m 55[2mms[22m[39m
       [32m‚úì[39m does nothing if already loading[32m 55[2mms[22m[39m
       [32m‚úì[39m does nothing if already embedded[32m 55[2mms[22m[39m
       [32m‚úì[39m initializes progress with zero values[32m 1[2mms[22m[39m
[31m       [31m√ó[31m calls embed endpoint even when hasEmbeddings is true[39m[32m 54[2mms[22m[39m
[31m       [31m√ó[31m updates state to loading then success when re-embedding[39m[33m 1011[2mms[22m[39m
[31m       [31m√ó[31m handles re-embed errors[39m[33m 1003[2mms[22m[39m
[31m       [31m√ó[31m does nothing if already loading[39m[32m 53[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m11 passed[39m[22m[90m (15)[39m
[2m   Start at [22m 10:12:28
[2m   Duration [22m 4.25s[2m (transform 70ms, setup 151ms, import 253ms, tests 2.59s, environment 847ms)[22m
---
timestamp: "2026-02-10 10:13:12"
story: "2-auto-embed"
chunk: "unknown"
tool: "Bash"
error: |
  Exit code 1
[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2minitial state[2m > [22m[2mstarts in idle state
[22m[39mFailed to check embedding status: TypeError: Cannot read properties of undefined (reading 'ok')
    at checkStatus [90m(/Users/darindrobinski/dev/repos/gold-miner/[39msrc/hooks/useEmbedding.ts:35:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2mcheckStatus[2m > [22m[2mhandles check status errors gracefully
[22m[39mFailed to check embedding status: Error: Network error
    at [90m/Users/darindrobinski/dev/repos/gold-miner/[39msrc/hooks/__tests__/useEmbedding.test.ts:62:39
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mtransitions through loading state
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mupdates state to success after successful embedding
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mhandles embedding errors
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behav

... [8390 characters truncated] ...

rorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2m‚ùØ[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/3]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/hooks/__tests__/useEmbedding.test.ts[2m > [22museEmbedding[2m > [22mreEmbed[2m > [22mhandles re-embed errors
[31m[1mAssertionError[22m: expected 'success' to be 'error' // Object.is equality

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div />[31m
  [36m</body>[31m
[36m</html>[31m[39m

Expected: [32m"error"[39m
Received: [31m"success"[39m

[36m [2m‚ùØ[22m src/hooks/__tests__/useEmbedding.test.ts:[2m404:38[22m[39m
    [90m402| [39m
    [90m403| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m404| [39m        [34mexpect[39m(result[33m.[39mcurrent[33m.[39mstate)[33m.[39m[34mtoBe[39m([32m'error'[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m405| [39m        [34mexpect[39m(result[33m.[39mcurrent[33m.[39merror)[33m.[39m[34mtoBe[39m([32m'Re-embedding failed'[39m)[33m;[39m
    [90m406| [39m      })[33m;[39m
[90m [2m‚ùØ[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2m‚ùØ[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/3]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/hooks/__tests__/useEmbedding.test.ts[2m > [22museEmbedding[2m > [22mreEmbed[2m > [22mdoes nothing if already loading
[31m[1mAssertionError[22m: expected 'error' to be 'loading' // Object.is equality

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div />[31m
  [36m</body>[31m
[36m</html>[31m[39m

Expected: [32m"loading"[39m
Received: [31m"error"[39m

[36m [2m‚ùØ[22m src/hooks/__tests__/useEmbedding.test.ts:[2m441:38[22m[39m
    [90m439| [39m
    [90m440| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m441| [39m        [34mexpect[39m(result[33m.[39mcurrent[33m.[39mstate)[33m.[39m[34mtoBe[39m([32m'loading'[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m442| [39m      })[33m;[39m
    [90m443| [39m
[90m [2m‚ùØ[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2m‚ùØ[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/3]‚éØ[22m[39m



> gold-miner@0.1.0 test
> vitest run src/hooks/__tests__/useEmbedding.test.ts


[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/Users/darindrobinski/dev/repos/gold-miner[39m

 [31m‚ùØ[39m src/hooks/__tests__/useEmbedding.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 3683[2mms[22m[39m
       [32m‚úì[39m starts in idle state[32m 19[2mms[22m[39m
       [32m‚úì[39m updates hasEmbeddings to true when embeddings exist[32m 54[2mms[22m[39m
       [32m‚úì[39m updates hasEmbeddings to false when no embeddings exist[32m 3[2mms[22m[39m
       [32m‚úì[39m handles check status errors gracefully[32m 5[2mms[22m[39m
       [32m‚úì[39m transitions through loading state[32m 107[2mms[22m[39m
       [32m‚úì[39m updates state to success after successful embedding[32m 56[2mms[22m[39m
       [32m‚úì[39m handles embedding errors[32m 89[2mms[22m[39m
       [32m‚úì[39m handles network errors[32m 57[2mms[22m[39m
       [32m‚úì[39m does nothing if already loading[32m 55[2mms[22m[39m
       [32m‚úì[39m does nothing if already embedded[32m 53[2mms[22m[39m
       [32m‚úì[39m initializes progress with zero values[32m 1[2mms[22m[39m
       [32m‚úì[39m calls embed endpoint even when hasEmbeddings is true[32m 55[2mms[22m[39m
[31m       [31m√ó[31m updates state to loading then success when re-embedding[39m[33m 1013[2mms[22m[39m
[31m       [31m√ó[31m handles re-embed errors[39m[33m 1056[2mms[22m[39m
[31m       [31m√ó[31m does nothing if already loading[39m[33m 1056[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (15)[39m
[2m   Start at [22m 10:13:06
[2m   Duration [22m 5.11s[2m (transform 65ms, setup 133ms, import 201ms, tests 3.68s, environment 761ms)[22m
---
timestamp: "2026-02-10 10:13:44"
story: "2-auto-embed"
chunk: "unknown"
tool: "Bash"
error: |
  Exit code 1
[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2minitial state[2m > [22m[2mstarts in idle state
[22m[39mFailed to check embedding status: TypeError: Cannot read properties of undefined (reading 'ok')
    at checkStatus [90m(/Users/darindrobinski/dev/repos/gold-miner/[39msrc/hooks/useEmbedding.ts:35:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2mcheckStatus[2m > [22m[2mhandles check status errors gracefully
[22m[39mFailed to check embedding status: Error: Network error
    at [90m/Users/darindrobinski/dev/repos/gold-miner/[39msrc/hooks/__tests__/useEmbedding.test.ts:62:39
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///Users/darindrobinski/dev/repos/gold-miner/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mtransitions through loading state
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mupdates state to success after successful embedding
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | src/hooks/__tests__/useEmbedding.test.ts[2m > [22m[2museEmbedding[2m > [22m[2membed[2m > [22m[2mhandles embedding errors
[22m[39mAn update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behav

... [7243 characters truncated] ...

ary/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/3]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/hooks/__tests__/useEmbedding.test.ts[2m > [22museEmbedding[2m > [22mreEmbed[2m > [22mhandles re-embed errors
[31m[1mAssertionError[22m: expected 'Failed to generate embeddings' to be 'Re-embedding failed' // Object.is equality

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div />[31m
  [36m</body>[31m
[36m</html>[31m[39m

Expected: [32m"[7mRe-[27membedding[7m failed[27m"[39m
Received: [31m"[7mFailed to generate [27membedding[7ms[27m"[39m

[36m [2m‚ùØ[22m src/hooks/__tests__/useEmbedding.test.ts:[2m409:38[22m[39m
    [90m407| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m408| [39m        [34mexpect[39m(result[33m.[39mcurrent[33m.[39mstate)[33m.[39m[34mtoBe[39m([32m'error'[39m)[33m;[39m
    [90m409| [39m        [34mexpect[39m(result[33m.[39mcurrent[33m.[39merror)[33m.[39m[34mtoBe[39m([32m'Re-embedding failed'[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m410| [39m      })[33m;[39m
    [90m411| [39m    })[33m;[39m
[90m [2m‚ùØ[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2m‚ùØ[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/3]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/hooks/__tests__/useEmbedding.test.ts[2m > [22museEmbedding[2m > [22mreEmbed[2m > [22mdoes nothing if already loading
[31m[1mAssertionError[22m: expected false to be true // Object.is equality

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div />[31m
  [36m</body>[31m
[36m</html>[31m[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m src/hooks/__tests__/useEmbedding.test.ts:[2m426:46[22m[39m
    [90m424| [39m
    [90m425| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m426| [39m        [34mexpect[39m(result[33m.[39mcurrent[33m.[39mhasEmbeddings)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m427| [39m      })[33m;[39m
    [90m428| [39m
[90m [2m‚ùØ[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2m‚ùØ[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/3]‚éØ[22m[39m



> gold-miner@0.1.0 test
> vitest run src/hooks/__tests__/useEmbedding.test.ts


[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/Users/darindrobinski/dev/repos/gold-miner[39m

 [31m‚ùØ[39m src/hooks/__tests__/useEmbedding.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 3597[2mms[22m[39m
       [32m‚úì[39m starts in idle state[32m 21[2mms[22m[39m
       [32m‚úì[39m updates hasEmbeddings to true when embeddings exist[32m 55[2mms[22m[39m
       [32m‚úì[39m updates hasEmbeddings to false when no embeddings exist[32m 3[2mms[22m[39m
       [32m‚úì[39m handles check status errors gracefully[32m 5[2mms[22m[39m
       [32m‚úì[39m transitions through loading state[32m 107[2mms[22m[39m
       [32m‚úì[39m updates state to success after successful embedding[32m 56[2mms[22m[39m
       [32m‚úì[39m handles embedding errors[32m 56[2mms[22m[39m
       [32m‚úì[39m handles network errors[32m 55[2mms[22m[39m
       [32m‚úì[39m does nothing if already loading[32m 54[2mms[22m[39m
       [32m‚úì[39m does nothing if already embedded[32m 54[2mms[22m[39m
       [32m‚úì[39m initializes progress with zero values[32m 1[2mms[22m[39m
       [32m‚úì[39m calls embed endpoint even when hasEmbeddings is true[32m 55[2mms[22m[39m
[31m       [31m√ó[31m updates state to loading then success when re-embedding[39m[33m 1013[2mms[22m[39m
[31m       [31m√ó[31m handles re-embed errors[39m[33m 1056[2mms[22m[39m
[31m       [31m√ó[31m does nothing if already loading[39m[33m 1004[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (15)[39m
[2m   Start at [22m 10:13:39
[2m   Duration [22m 5.21s[2m (transform 77ms, setup 165ms, import 246ms, tests 3.60s, environment 848ms)[22m
