# Craft State Export (Pre-Compact)

This file was created automatically before context compaction.
Use this to restore state if needed.

## Global State
```bash
LAST_ACTIVITY="2026-02-06T22:34:31Z"
ACTIVE_CYCLE="mcp-intelligence"
CURRENT_STORY="3-temporal-graph-rag"
DEFAULT_MODE="creative"
BACKLOG_COUNT=1
HARNESS_CHECKED="2026-02-03"
HARNESS_VERSION="1.0"
CRAFT_WRITE_ENABLED="true"
PLANNING_CYCLE=""
RUN_MODE="cruise"
```

## Cycle State: mcp-intelligence
```bash
CYCLE_NAME="mcp-intelligence"
CYCLE_STATUS="active"
CURRENT_STORY="3-temporal-graph-rag"
CURRENT_CHUNK="1"
TOTAL_CHUNKS="5"
LAST_VALIDATION="2026-02-06T22:18:46Z"
LAST_CHECKPOINT="2026-02-06T22:34:31Z"
TOUCHED_FILES="/Users/darindrobinski/dev/repos/gold-miner/src/lib/mcp/__tests__/types.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/mcp/types.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/test-mcp-debug.js /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/mcp/__tests__/tools.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/mcp/tools.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/search.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/__tests__/search.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/mcp/__tests__/auth.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/mcp/auth.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/mcp/[transport]/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/README.md /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/__tests__/relationships.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/graph/__tests__/types.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/schema.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/__tests__/setup.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/graph/types.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/graph/__tests__/compute-relationships.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/graph/compute-relationships.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/graph/index.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/embeddings/__tests__/service.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/embed/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/embed/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/embeddings/types.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/embeddings/service.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/embed/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/embed/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/embed/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/graph/__tests__/traverse.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/graph/traverse.ts /Users/darindrobinski/dev/repos/gold-miner/test-debug.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/related/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/related/route.ts /Users/darindrobinski/dev/repos/gold-miner/test-api-manual.ts /Users/darindrobinski/dev/repos/gold-miner/test-cross-video.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/video/__tests__/RelatedTab.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/hooks/useRelatedChunks.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/video/RelatedChunkCard.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/video/RelatedTab.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/InsightsTabs.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/__tests__/InsightsTabs.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/VideoCard.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/VideoGrid.test.tsx"
```

## Current Story
File: .craft/cycles/mcp-intelligence/stories/3-temporal-graph-rag.md

```markdown
---
name: temporal-graph-rag
title: Temporal Graph RAG
status: active
priority: medium
created: 2026-02-05
updated: 2026-02-06
cycle: mcp-intelligence
story_number: 3
chunks_total: 5
chunks_complete: 0
current_chunk: 0
---

# Story: Temporal Graph RAG

## Spark

Add time-awareness to prevent outdated information from dominating results. When someone asks about "Cursor", don't return year-old information when the tool has changed significantly.

Detect version mentions, release dates, and freshness signals. Apply temporal decay to search scoring so newer content ranks higher.

> *"So if you say, hey. Tell me about cursor. It'll say, oh, I found 20 cursor things. And the one that's most relevant to your query is one from a year ago. It's gonna give you outdated cursor information."*
> *"Once you add a temporal graph rag, it will say, oh, he talked about this version of cursor. A new one came out. This one is outdated. Based off of a temporal timeline."*

## Dependencies

**Blocked by:** Story 2 (Graph RAG) — both modify `embeddings/service.ts`
**Blocks:** None

## Acceptance

- [ ] `publishedAt` field on videos table stores actual video publish date
- [ ] Temporal metadata extracted from chunk content (version mentions, dates)
- [ ] Search scoring applies temporal decay (older = lower relevance)
- [ ] Decay half-life configurable (default 365 days)
- [ ] API supports `temporalDecay` query parameter
- [ ] Freshness badge shows on search results (color-coded by age)
- [ ] Extraction errors don't break embedding flow
- [ ] Tests cover extraction, decay math, and UI

## Chunks

### Chunk 1: Add publishedAt to Videos Schema

**Goal:** Add `publishedAt` field to videos table and fetch publish date when adding videos.

**Files:**
- `src/lib/db/schema.ts` — modify (add publishedAt field)
- `src/lib/youtube/metadata.ts` — modify (fetch publishedAt from YouTube)
```

## Recent Checkpoints
```
dbc8ceb checkpoint: before story 3, chunk 1
02be31f story 2 complete: Graph RAG
b4d7049 story 2, chunk 5: Related Tab UI
ac7afca checkpoint: before story 2, chunk 5
310691b story 2, chunk 4: graph traversal & related API
5075c27 checkpoint: before story 2, chunk 4
366fca3 story 2, chunk 3: auto-compute relationships after embedding
d20d06a checkpoint: before story 2, chunk 3
8d9c525 story 2, chunk 2: compute relationships function
a21a315 checkpoint: before story 2, chunk 2
```
