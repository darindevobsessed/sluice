# Craft State Export (Pre-Compact)

This file was created automatically before context compaction.
Use this to restore state if needed.

## Global State
```bash
LAST_ACTIVITY="2026-02-04T18:15:54Z"
ACTIVE_CYCLE="mvp"
CURRENT_STORY="4-claude-insights"
DEFAULT_MODE="creative"
BACKLOG_COUNT=0
HARNESS_CHECKED="2026-02-03"
HARNESS_VERSION="1.0"
CRAFT_WRITE_ENABLED="true"
```

## Cycle State: mvp
```bash
CYCLE_NAME="mvp"
CYCLE_STATUS="active"
CURRENT_STORY="4-claude-insights"
CURRENT_CHUNK="1"
TOTAL_CHUNKS="5"
LAST_VALIDATION="2026-02-04T15:08:57Z"
LAST_CHECKPOINT="2026-02-04T18:15:54Z"
TOUCHED_FILES="/Users/darindrobinski/dev/repos/gold-miner/vitest.config.ts /Users/darindrobinski/dev/repos/gold-miner/package.json /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/index.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/__tests__/search.test.ts /Users/darindrobinski/dev/repos/gold-miner/vitest.setup.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/VideoCard.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/StatsHeader.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/EmptyState.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/VideoCard.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/StatsHeader.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/EmptyState.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/VideoSearch.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/VideoGrid.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/VideoGrid.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/VideoSearch.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/CLAUDE.md /Users/darindrobinski/dev/repos/gold-miner/src/lib/transcript/types.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/transcript/__tests__/parse.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/transcript/parse.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/VideoPlayer.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/TranscriptView.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/VideoMetadata.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/TranscriptView.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/VideoPlayer.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/agent/auth.ts /Users/darindrobinski/dev/repos/gold-miner/src/agent/chat.ts /Users/darindrobinski/dev/repos/gold-miner/src/agent/server.ts /Users/darindrobinski/dev/repos/gold-miner/src/agent/index.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/agent/connection.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/agent/AgentProvider.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/api/agent/token/route.ts /Users/darindrobinski/dev/repos/gold-miner/.gitignore /Users/darindrobinski/dev/repos/gold-miner/src/agent/__tests__/auth.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/agent/__tests__/connection.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/agent/token/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/tsconfig.json /Users/darindrobinski/dev/repos/gold-miner/src/lib/claude/prompts/__tests__/extract.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/claude/prompts/types.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/claude/prompts/extract.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/claude/prompts/index.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/claude/prompts/__tests__/index.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/claude/prompts/__tests__/integration.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/schema.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/__tests__/insights.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/db/insights.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/insights/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/insights/route.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/insights/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/insights/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/insights/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/insights/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/__tests__/CopyButton.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/__tests__/InsightSection.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/__tests__/InsightsPanel.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/__tests__/ClaudeCodeSection.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/__tests__/InsightsTabs.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/CopyButton.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/InsightSection.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/ClaudeCodeSection.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/InsightsPanel.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/insights/InsightsTabs.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/lib/claude/prompts/__tests__/parser.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/claude/prompts/parser.ts /Users/darindrobinski/dev/repos/gold-miner/src/hooks/__tests__/useExtraction.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/hooks/useExtraction.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/agent/__tests__/AgentProvider.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/layout.tsx"
```

## Current Story
File: .craft/cycles/mvp/stories/4-claude-insights.md

```markdown
---
name: claude-insights
title: Claude Insights
status: active
priority: high
created: 2026-02-03
updated: 2026-02-04
cycle: mvp
story_number: 4
chunks_total: 5
chunks_complete: 0
---

# Story: Claude Insights

## Spark

The "gold" in Gold Miner — Claude-powered knowledge extraction using a **Single Smart Button** pattern. On the video detail page, a tab system shows Transcript and Insights. The Insights tab has one "Extract Insights" button that:

1. **Analyzes the transcript** to determine content type (dev tutorial, meeting, talk, etc.)
2. **Runs appropriate extractions in parallel** based on content type
3. **Shows all results in a unified streaming view** with copy buttons

**Universal extractions (all content):**
- Summary (TL;DR + overview + key points)
- Key Insights (timestamped, actionable takeaways)
- Action Items (immediate, short-term, long-term)

**Dev-specific extractions (technical content only):**
- Claude Code Plugins: Skills, Commands, Agents, Hooks, Rules
- Copy-paste ready format for `.claude/` directory

Uses **Local Agent Architecture** — a terminal-based agent leverages `@anthropic-ai/claude-agent-sdk` to use Claude Code's existing authentication (no API key needed). Results persist so users build a "dossier" per video.

## Dependencies

**Blocked by:** Story 3 (Knowledge Bank) — needs video detail page with transcript
**Blocks:** None

## Acceptance

- [ ] Video detail page has Transcript | Insights tabs
- [ ] Insights tab shows single "Extract Insights" button initially
- [ ] Clicking Extract starts unified streaming view with all sections
- [ ] Sections stream in sequence: Summary → Key Insights → Action Items → (Claude Code Plugins if dev content)
- [ ] Each section shows status: ○ Pending → ● Working → ✓ Done
- [ ] Streaming output appears word-by-word with cursor animation
- [ ] Each completed section has [Copy] button
- [ ] Claude Code Plugins section has expandable items with individual [Copy] buttons
- [ ] Copy buttons copy exact format ready for `.claude/` directory
```

## Recent Checkpoints
```
359a9fa checkpoint: before story 4, chunk 1
fb16f99 story 3, chunk 5: video detail page
c9536e1 checkpoint: before story 3, chunk 5
eec7588 story 3, chunk 4: transcript parser utility
908092f checkpoint: before story 3, chunk 4
88d0acd story 3, chunk 3: Knowledge Bank page
ef51ce0 checkpoint: before story 3, chunk 3
22d9f8e story 3, chunk 2: video card & stats components
d24dac4 checkpoint: before story 3, chunk 2
0339cf1 story 3, chunk 1: FTS5 search with tests
```
