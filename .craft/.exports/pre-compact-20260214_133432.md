# Craft State Export (Pre-Compact)

This file was created automatically before context compaction.
Use this to restore state if needed.

## Global State
```bash
LAST_ACTIVITY="2026-02-14T19:32:48Z"
ACTIVE_CYCLE="10-state-navigation"
CURRENT_STORY="5-in-bank-navigation"
DEFAULT_MODE="creative"
BACKLOG_COUNT="1"
HARNESS_CHECKED="2026-02-03"
HARNESS_VERSION="1.0"
CRAFT_WRITE_ENABLED="true"
PLANNING_CYCLE=""
RUN_MODE="cruise"
```

## Cycle State: State & Navigation
```bash
CYCLE_NAME="state-navigation"
CYCLE_STATUS="ready"
CURRENT_STORY="5-in-bank-navigation"
CURRENT_CHUNK="2"
TOTAL_CHUNKS="2"
LAST_VALIDATION="2026-02-14T19:30:53Z"
LAST_CHECKPOINT="2026-02-14T19:32:48Z"
TOUCHED_FILES=" /Users/darindrobinski/dev/repos/gold-miner/src/hooks/__tests__/useSearch.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/hooks/useSearch.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/VideoSearch.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/VideoSearch.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/knowledge-bank/KnowledgeBankContent.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/discovery/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/discovery/DiscoveryContent.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/discovery/__tests__/DiscoveryVideoGrid.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/lib/__tests__/navigation.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/lib/navigation.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/add-video/__tests__/SuccessState.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/add-video/SuccessState.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/add-video/__tests__/AddVideoPage.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/add-transcript/__tests__/AddTranscriptPage.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/add-video/AddVideoPage.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/add-transcript/AddTranscriptPage.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/discovery/DiscoveryVideoGrid.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/discovery/DiscoveryVideoCard.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/__tests__/VideoCard.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/discovery/__tests__/DiscoveryVideoCard.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/VideoCard.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/page.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/videos/VideoGrid.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/videos/[id]/__tests__/page.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/app/api/videos/[id]/insights/__tests__/route.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/filters/__tests__/FilterPillBar.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/filters/FilterPillBar.tsx /Users/darindrobinski/dev/repos/gold-miner/src/hooks/useURLParams.ts /Users/darindrobinski/dev/repos/gold-miner/src/components/discovery/__tests__/FloatingBatchBar.test.tsx /Users/darindrobinski/dev/repos/gold-miner/src/components/discovery/FloatingBatchBar.tsx /Users/darindrobinski/dev/repos/gold-miner/src/hooks/__tests__/useBatchAdd.test.ts /Users/darindrobinski/dev/repos/gold-miner/src/hooks/useBatchAdd.ts"
```

## Current Story
File: .craft/cycles/10-state-navigation/stories/5-in-bank-navigation.md

```markdown
---
name: discovery-in-bank-navigation
title: "Navigate to Video Detail from Discovery (In-Bank Videos)"
status: active
cycle: state-navigation
story_number: 5
created: 2026-02-14
updated: 2026-02-14
priority: high
chunks_total: 2
chunks_complete: 1
---

# Story: Navigate to Video Detail from Discovery (In-Bank Videos)

## Spark
On the Discovery page, videos already in the knowledge bank should be clickable to navigate to their video detail page (`/videos/[id]`). Currently they only show an "In Bank" badge with no navigation affordance. The card thumbnail and title should link to the detail page, with `returnTo` support so the user can navigate back to Discovery with their filters preserved.

## Delivery
Chunk 1 builds a `youtubeId → dbId` map from the existing bank videos API response and plumbs it through DiscoveryVideoGrid to DiscoveryVideoCard as a `bankVideoId` prop. Chunk 2 uses that prop to wrap the thumbnail and title in a Next.js Link for in-bank videos, with `returnTo` query param for back-navigation. Together they make every in-bank video on Discovery a one-tap path to its detail page.

## Acceptance
- [ ] Given a video in the bank on Discovery, when I click the thumbnail or title, then I navigate to `/videos/[id]`
- [ ] Given I navigated from Discovery with filters active, when I use the back button on the detail page, then I return to Discovery with my filters preserved
- [ ] Given a video NOT in the bank, when I view it on Discovery, then the card behavior is unchanged (Add to Bank button, batch select checkbox)

## Chunks

### Chunk 1: Data Map + Prop Plumbing

**Goal:** Build `bankIdMap` in DiscoveryContent and pass through to cards.

**Files:**
- `src/components/discovery/DiscoveryContent.tsx` — modify
- `src/components/discovery/DiscoveryVideoGrid.tsx` — modify
- `src/components/discovery/DiscoveryVideoCard.tsx` — modify (add prop only)
- `src/components/discovery/__tests__/DiscoveryVideoCard.test.tsx` — modify

**Implementation Details:**
- In `DiscoveryContent.tsx`, inside the `fetchVideos` callback (line 122-132), alongside the `youtubeIdMap` for focus areas, build a parallel map:
  ```ts
  const bankIdMap: Record<string, number> = {}
  for (const video of bankData.videos) {
    if (video.youtubeId) {
      bankIdMap[video.youtubeId] = video.id
    }
  }
  ```
- Add state: `const [bankIdMap, setBankIdMap] = useState<Record<string, number>>({})`
- Pass `bankIdMap` to `<DiscoveryVideoGrid>` (line 333-343)
```

## Recent Checkpoints
```
6e0a60e checkpoint: before chunk 2 -- in-bank-navigation
955cc70 checkpoint: before chunk 1 -- in-bank-navigation
b785d1f checkpoint: before chunk 3 -- add-from-discovery
9731ac6 checkpoint: before chunk 2 -- add-from-discovery
c39d72a checkpoint: before chunk 1 -- add-from-discovery
7b2c93b checkpoint: before chunk 3 -- active-filter-pills
c9940b7 checkpoint: before chunk 2 -- active-filter-pills
edae503 checkpoint: before chunk 1 -- active-filter-pills
29333d7 checkpoint: before chunk 3 -- context-aware-navigation
2772832 checkpoint: before chunk 2 -- context-aware-navigation
```
